/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package GUI;

import GUIWarnings.MinimoCaracteres;
import GUIWarnings.PlayerNotFound;
import battleshipgame.Player;
import java.awt.Color;
import java.awt.Font;
import javax.swing.BorderFactory;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JPasswordField;
import javax.swing.JTextField;
import javax.swing.JToggleButton;
import javax.swing.border.BevelBorder;

/**
 *
 * @author nasry
 */
public class LogIn {
     JFrame frame;
    JPasswordField passField;
    char defaultEcho;

    public LogIn() {
        frame = new JFrame("LogIn");
        frame.setSize(776, 590);
        frame.setLayout(null);
        frame.setLocationRelativeTo(null);
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        frame.setResizable(false);

        JPanel mainPanel = new JPanel();
        mainPanel.setBackground(Color.BLACK);
        mainPanel.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED,
                null, null, Color.GREEN, Color.GREEN));
        mainPanel.setLayout(null);

        mainPanel.setBounds(120, 90, 520, 430);

        JLabel title = new JLabel("LOG IN");
        title.setBounds(190, 20, 150, 90);
        title.setFont(new Font("Inlanders", Font.PLAIN, 52));
        title.setForeground(Color.GREEN);
        mainPanel.add(title);

        JLabel userLbl = new JLabel("username:");
        userLbl.setBounds(60, 110, 200, 70);
        userLbl.setFont(new Font("Inlanders", Font.PLAIN, 24));
        userLbl.setForeground(new Color(22, 188, 63));
        mainPanel.add(userLbl);

        JTextField userField = new JTextField();
        userField.setBounds(30, 170, 250, 40);
        userField.setFont(new Font("OCR A Extended", Font.BOLD, 20));
        userField.setBackground(new Color(34, 33, 33));
        userField.setForeground(Color.GREEN);
        userField.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED,
                null, null, Color.GREEN, Color.GREEN));
        mainPanel.add(userField);

        JLabel passLbl = new JLabel("password:");
        passLbl.setBounds(50, 210, 210, 70);
        passLbl.setFont(new Font("Inlanders", Font.PLAIN, 24));
        passLbl.setForeground(new Color(22, 188, 63));
        mainPanel.add(passLbl);

        passField = new JPasswordField();
        passField.setBounds(30, 270, 250, 40);
        passField.setFont(new Font("OCR A Extended", Font.BOLD, 20));
        passField.setBackground(new Color(34, 33, 33));
        passField.setForeground(Color.GREEN);
        passField.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED,
                null, null, Color.GREEN, Color.GREEN));
        mainPanel.add(passField);

        defaultEcho = passField.getEchoChar();

        JToggleButton showPass = new JToggleButton();
        showPass.setIcon(new ImageIcon(getClass().getResource("/Images/eyeClosed.png")));
        showPass.setBounds(300, 270, 50, 40);
        showPass.setBackground(new Color(34, 34, 34));
        showPass.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED,
                null, null, Color.GREEN, Color.GREEN));
        mainPanel.add(showPass);

        JButton exitBtn = new JButton("SALIR");
        exitBtn.setBounds(30, 360, 170, 40);
        exitBtn.setBackground(new Color(34, 33, 33));
        exitBtn.setForeground(new Color(0, 204, 0));
        exitBtn.setFont(new Font("Inlanders", Font.PLAIN, 24));
        exitBtn.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED,
                null, null, Color.GREEN, Color.GREEN));
        mainPanel.add(exitBtn);

        JButton nextBtn = new JButton("SIGUIENTE");
        nextBtn.setBounds(320, 360, 170, 40);
        nextBtn.setBackground(new Color(34, 33, 33));
        nextBtn.setForeground(new Color(0, 204, 0));
        nextBtn.setFont(new Font("Inlanders", Font.PLAIN, 24));
        nextBtn.setBorder(BorderFactory.createBevelBorder(BevelBorder.RAISED,
                null, null, Color.GREEN, Color.GREEN));
        mainPanel.add(nextBtn);

        frame.add(mainPanel);

        JLabel bg = new JLabel(new ImageIcon(getClass().getResource("/Images/UserScreen.png")));
        bg.setBounds(0, 0, 776, 590);
        frame.add(bg);

        showPass.addActionListener(e -> {
            passField.setEchoChar(showPass.isSelected() ? (char) 0 : defaultEcho);
        });

        // --- ACCIÓN CORREGIDA ---
        nextBtn.addActionListener(e -> {
            String user = userField.getText().trim();
            String pass = new String(passField.getPassword()).trim();

            if (!Player.lengthValido(user) || !Player.lengthValido(pass)) {
                new MinimoCaracteres();
                return;
            }

            // 1. Intentamos obtener el objeto Player directamente
            Player jugadorLogueado = Player.login(user, pass);

            if (jugadorLogueado != null) {
                // 2. Creamos el juego
                battleshipgame.Battleship game = new battleshipgame.Battleship();
                
                // 3. CLAVE: Le decimos al juego QUIÉN es el usuario actual
                game.setCurrentUser(jugadorLogueado);

                frame.dispose();
                new MenuPrincipal(game); 
            } else {
                new PlayerNotFound();
            }
        });

        exitBtn.addActionListener(e -> {
            frame.dispose();
            new MenuInicio();
        });

        frame.setVisible(true);
    }
}